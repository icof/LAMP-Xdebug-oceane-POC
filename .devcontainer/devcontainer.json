// Pour le format complet : https://aka.ms/devcontainer.json
// Options détaillées : https://github.com/devcontainers/templates/tree/main/src/php
{
	"name": "PHP",
	// Construit l'image de dev à partir du Dockerfile situé à la racine du dépôt
	"build": {
		"dockerfile": "Dockerfile",
		"context": ".."
	},

	// Personnalisations côté éditeur dans le conteneur
	"customizations": {
		// Paramètres spécifiques à VS Code
		"vscode": {
			"settings": {
				// Éditeur : retour à la ligne automatique pour éviter le scroll horizontal
				"editor.wordWrap": "on",
				"editor.formatOnSave": true,
				"editor.tabSize": 4,
				"editor.insertSpaces": false,
				// PHP : formateur par défaut
				"[php]": {
					"editor.defaultFormatter": "bmewburn.vscode-intelephense-client"
				},
				// Git : récupération automatique des mises à jour
				"git.autofetch": true
			},
			"extensions": [ // Extensions VS Code installées automatiquement	
				"kisstkondoros.vscode-codemetrics",
				"ms-azuretools.vscode-docker",
				"bmewburn.vscode-intelephense-client",
				"esbenp.prettier-vscode",
				"neilbrayfield.php-docblocker",
				"SonarSource.sonarlint-vscode",
				"cweijan.vscode-mysql-client2",
				"donjayamanne.githistory",
				"Github.copilot"
			]
		}
	},

	// Définition des ports exposés avec leurs libellés (réf. : https://code.visualstudio.com/docs/remote/devcontainerjson-reference)
	"portsAttributes": {
		"8000": {
			"label": "site web",
			"onAutoForward": "notify"
		},
		"8080": {
			"label": "phpMyAdmin",
			"onAutoForward":"notify"
		}
	},

	// Variables d'environnement injectées dans le conteneur
	"containerEnv": {
		"MYSQL_ADMIN_USER": "admin",
		"MYSQL_ADMIN_PASSWORD": "admin_password",
		"DATABASE_NAME": "app_database"
	},

	// Commande exécutée à la fin de la création du conteneur
   "postCreateCommand": "chmod +x .devcontainer/setup-lamp.sh && .devcontainer/setup-lamp.sh" // initialise toute la stack LAMP

	// Décommenter pour se connecter en root dans le conteneur (réf. : https://aka.ms/dev-containers-non-root)
	// "remoteUser": "root"
}
